version: '2'
services:
  router:
    container_name: router
    hostname: myapp
    domainname: myapp.com
    #    command:
    #      - sh
    #      - /app/onStartServer.sh
    extends:
      file: ./base-compose.yml
      service: router
    environment:
      PORT: ${PORT}
    volumes:
      - ./config/default.conf:/etc/nginx/conf.d/default.conf
      - ../logs/router:/var/log/nginx
#      - ./config/onStartServer.sh:/app/onStartServer.sh
#      - ./config/default.conf:/app/test.conf:rw

  server-app-1:
    container_name: server-app-1
    logging:
      driver: none
    extends:
      file: ./base-compose.yml
      service: server-app
    environment:
      PORT: 3000
    volumes:
      - ../server:/usr/share/app

  server-app-2:
    container_name: server-app-2
    extends:
      file: ./base-compose.yml
      service: server-app
    environment:
      PORT: 4000
    volumes:
      - ../server:/usr/share/app

  server-app-3:
    container_name: server-app-3
    extends:
      file: ./base-compose.yml
      service: server-app
    environment:
      PORT: 5000
    volumes:
      - ../server:/usr/share/app

  server-app-4:
    container_name: server-app-4
    extends:
      file: ./base-compose.yml
      service: server-app
    environment:
      PORT: 6000
    volumes:
      - ../server:/usr/share/app

  server-app-5:
    container_name: server-app-5
    extends:
      file: ./base-compose.yml
      service: server-app
    environment:
      PORT: 7000
    volumes:
      - ../server:/usr/share/app

  server-app-6:
    container_name: server-app-6
    extends:
      file: ./base-compose.yml
      service: server-app
    working_dir: /usr/share/app
    environment:
      PORT: 8000
    volumes:
      - ../server:/usr/share/app

  server-app-7:
    container_name: server-app-7
    extends:
      file: ./base-compose.yml
      service: server-app-no-host
    networks:
      strawberry_net:
       ipv4_address: 174.17.0.200
    environment:
      PORT: 80
    volumes:
      - ../server:/usr/share/app

networks:
  strawberry_net:
    driver: bridge
    ipam:
      driver: default
      config:
        - subnet: 174.17.0.0/16
    driver_opts:
      "com.docker.network.bridge.name": "strawberry-net"

